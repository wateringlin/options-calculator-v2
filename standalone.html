<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æœŸæƒå‚ç›´ä»·å·®è®¡ç®—å™¨</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
/* ===== CSS Variables ===== */
:root {
    --bg-primary: #0f0f1a;
    --bg-secondary: #1a1a2e;
    --bg-card: linear-gradient(145deg, #1e1e32, #16162a);
    --text-primary: #ffffff;
    --text-secondary: #a0a0b8;
    --text-muted: #6a6a80;
    --accent-green: #00d68f;
    --accent-green-glow: rgba(0, 214, 143, 0.3);
    --accent-red: #ff4d6a;
    --accent-red-glow: rgba(255, 77, 106, 0.3);
    --accent-blue: #5c7cfa;
    --accent-purple: #9775fa;
    --accent-orange: #ff922b;
    --border-color: rgba(255, 255, 255, 0.08);
    --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.3);
    --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.4);
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 16px;
}

* { margin: 0; padding: 0; box-sizing: border-box; }
html { font-size: 14px; }

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    min-height: 100vh;
    line-height: 1.5;
    -webkit-font-smoothing: antialiased;
}

.container {
    max-width: 480px;
    margin: 0 auto;
    padding: 10px;
    padding-bottom: 20px;
}

.header {
    text-align: center;
    padding: 12px 0 8px;
}

.header h1 {
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 2px;
    background: linear-gradient(135deg, #fff, #a0a0ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.subtitle {
    font-size: 0.75rem;
    color: var(--text-secondary);
}

.card {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    padding: 12px;
    margin-bottom: 10px;
    box-shadow: var(--shadow-sm);
}

.card-title {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 8px;
}

.section-desc {
    font-size: 0.7rem;
    color: var(--text-muted);
    margin-bottom: 10px;
}

.input-group {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 16px;
}

.input-item label {
    display: block;
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-bottom: 6px;
}

.input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    transition: all 0.2s ease;
}

.input-wrapper:focus-within {
    border-color: var(--accent-blue);
    box-shadow: 0 0 0 3px rgba(92, 124, 250, 0.2);
}

.input-wrapper .currency {
    padding-left: 12px;
    color: var(--text-secondary);
    font-weight: 500;
}

.input-wrapper input {
    flex: 1;
    background: transparent;
    border: none;
    padding: 12px;
    padding-left: 4px;
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text-primary);
    outline: none;
    width: 100%;
}

.input-wrapper input::placeholder { color: var(--text-muted); }
.input-wrapper.small { max-width: 100px; }
.input-wrapper.small input {
    padding: 8px 4px 8px 12px;
    font-size: 1rem;
    text-align: center;
}

.input-wrapper .unit {
    padding-right: 12px;
    color: var(--text-secondary);
    font-weight: 500;
}

.net-credit {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    background: rgba(92, 124, 250, 0.1);
    border-radius: var(--radius-sm);
    border: 1px solid rgba(92, 124, 250, 0.2);
}

.net-credit span:first-child {
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.net-credit-value {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--accent-blue);
}

.settings-group {
    display: flex;
    justify-content: space-between;
    gap: 16px;
}

.setting-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex: 1;
}

.setting-item label {
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.leg-section { border-left: 3px solid; }
.short-leg-section { border-left-color: var(--accent-red); }
.long-leg-section { border-left-color: var(--accent-green); }

.futu-settings {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.futu-setting {
    background: rgba(0, 0, 0, 0.2);
    border-radius: var(--radius-md);
    overflow: hidden;
}

.futu-setting.profit { border: 1px solid rgba(0, 214, 143, 0.2); }
.futu-setting.loss { border: 1px solid rgba(255, 77, 106, 0.2); }

.futu-header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 12px;
    background: rgba(255, 255, 255, 0.03);
    border-bottom: 1px solid var(--border-color);
}

.futu-icon { font-size: 0.9rem; }
.futu-label { font-size: 0.8rem; font-weight: 600; flex: 1; }

.futu-badge {
    font-size: 0.65rem;
    font-weight: 600;
    padding: 3px 8px;
    border-radius: 20px;
}

.profit-badge { background: rgba(0, 214, 143, 0.2); color: var(--accent-green); }
.loss-badge { background: rgba(255, 77, 106, 0.2); color: var(--accent-red); }
.muted-badge { background: rgba(255, 255, 255, 0.1); color: var(--text-muted); }

.futu-body { padding: 8px 12px; }

.futu-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 0;
}

.futu-row.highlight {
    background: rgba(255, 255, 255, 0.03);
    margin: 4px -12px;
    padding: 10px 12px;
    border-radius: var(--radius-sm);
}

.futu-key { font-size: 0.75rem; color: var(--text-muted); }
.futu-val { font-size: 0.8rem; color: var(--text-secondary); }

.futu-price {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text-primary);
}

.futu-setting.profit .futu-price {
    color: var(--accent-green);
    text-shadow: 0 0 15px var(--accent-green-glow);
}

.futu-setting.loss .futu-price {
    color: var(--accent-red);
    text-shadow: 0 0 15px var(--accent-red-glow);
}

.summary-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 12px;
}

.summary-item {
    text-align: center;
    padding: 12px 8px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: var(--radius-sm);
}

.summary-label {
    display: block;
    font-size: 0.7rem;
    color: var(--text-muted);
    margin-bottom: 4px;
}

.summary-value {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-primary);
}

.summary-item.profit .summary-value { color: var(--accent-green); }
.summary-item.loss .summary-value { color: var(--accent-red); }

.tips-section {
    background: rgba(151, 117, 250, 0.08);
    border-color: rgba(151, 117, 250, 0.2);
}

.tips-content p {
    font-size: 0.75rem;
    color: var(--text-secondary);
    margin-bottom: 8px;
    padding-left: 8px;
    border-left: 2px solid var(--accent-purple);
}

.tips-content p:last-child { margin-bottom: 0; }
.tips-content strong { color: var(--text-primary); }

.footer { text-align: center; padding: 16px; }
.footer p { font-size: 0.75rem; color: var(--text-muted); }

@media (max-width: 360px) {
    .container { padding: 12px; }
    .input-group { grid-template-columns: 1fr; }
    .settings-group { flex-direction: column; gap: 12px; }
    .summary-grid { grid-template-columns: 1fr; }
}

@supports (padding-bottom: env(safe-area-inset-bottom)) {
    .container { padding-bottom: calc(32px + env(safe-area-inset-bottom)); }
}
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ“Š æœŸæƒä»·å·®è®¡ç®—å™¨</h1>
            <p class="subtitle">Credit Spread å•è…¿æ­¢ç›ˆæ­¢æŸè®¡ç®—</p>
        </header>

        <main class="main">
            <section class="card input-section">
                <h2 class="card-title">ğŸ’° å¼€ä»“ä»·æ ¼</h2>
                <div class="input-group">
                    <div class="input-item">
                        <label for="sellPrice">å–å‡ºä»· (Short Leg)</label>
                        <div class="input-wrapper">
                            <span class="currency">$</span>
                            <input type="number" id="sellPrice" placeholder="0.67" step="0.01" min="0" inputmode="decimal">
                        </div>
                    </div>
                    <div class="input-item">
                        <label for="buyPrice">ä¹°å…¥ä»· (Long Leg)</label>
                        <div class="input-wrapper">
                            <span class="currency">$</span>
                            <input type="number" id="buyPrice" placeholder="0.17" step="0.01" min="0" inputmode="decimal">
                        </div>
                    </div>
                </div>
                <div class="net-credit">
                    <span>å‡€æ”¶å…¥ (Net Credit)</span>
                    <span class="net-credit-value" id="netCredit">$0.00</span>
                </div>
            </section>

            <section class="card settings-section">
                <h2 class="card-title">âš™ï¸ æ­¢ç›ˆæ­¢æŸæ¯”ä¾‹</h2>
                <div class="settings-group">
                    <div class="setting-item">
                        <label for="takeProfitPercent">æ­¢ç›ˆæ¯”ä¾‹</label>
                        <div class="input-wrapper small">
                            <input type="number" id="takeProfitPercent" value="75" step="5" min="0" max="100" inputmode="numeric">
                            <span class="unit">%</span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label for="stopLossPercent">æ­¢æŸæ¯”ä¾‹</label>
                        <div class="input-wrapper small">
                            <input type="number" id="stopLossPercent" value="200" step="10" min="0" inputmode="numeric">
                            <span class="unit">%</span>
                        </div>
                    </div>
                </div>
            </section>

            <section class="card leg-section short-leg-section">
                <h2 class="card-title">ğŸ”´ Short Leg å¯Œé€”è®¾ç½®</h2>
                <p class="section-desc">å–å‡ºçš„æœŸæƒï¼Œéœ€è¦ä¹°å›å¹³ä»“</p>
                
                <div class="futu-settings">
                    <div class="futu-setting profit">
                        <div class="futu-header">
                            <span class="futu-icon">âœ…</span>
                            <span class="futu-label">æ­¢ç›ˆå•</span>
                            <span class="futu-badge profit-badge" id="shortProfitBadge">ç›ˆåˆ© $0.00</span>
                        </div>
                        <div class="futu-body">
                            <div class="futu-row">
                                <span class="futu-key">æ¡ä»¶ç±»å‹</span>
                                <span class="futu-val">ä»·æ ¼ â‰¤ è§¦å‘ä»·</span>
                            </div>
                            <div class="futu-row highlight">
                                <span class="futu-key">è§¦å‘ä»·æ ¼</span>
                                <span class="futu-val futu-price" id="shortTpPrice">$0.00</span>
                            </div>
                            <div class="futu-row">
                                <span class="futu-key">è®¢å•ç±»å‹</span>
                                <span class="futu-val">å¸‚ä»·ä¹°å…¥</span>
                            </div>
                        </div>
                    </div>

                    <div class="futu-setting loss">
                        <div class="futu-header">
                            <span class="futu-icon">ğŸ›‘</span>
                            <span class="futu-label">æ­¢æŸå•</span>
                            <span class="futu-badge loss-badge" id="shortLossBadge">äºæŸ $0.00</span>
                        </div>
                        <div class="futu-body">
                            <div class="futu-row">
                                <span class="futu-key">æ¡ä»¶ç±»å‹</span>
                                <span class="futu-val">ä»·æ ¼ â‰¥ è§¦å‘ä»·</span>
                            </div>
                            <div class="futu-row highlight">
                                <span class="futu-key">è§¦å‘ä»·æ ¼</span>
                                <span class="futu-val futu-price" id="shortSlPrice">$0.00</span>
                            </div>
                            <div class="futu-row">
                                <span class="futu-key">è®¢å•ç±»å‹</span>
                                <span class="futu-val">å¸‚ä»·ä¹°å…¥</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="card leg-section long-leg-section">
                <h2 class="card-title">ğŸŸ¢ Long Leg å¯Œé€”è®¾ç½®</h2>
                <p class="section-desc">ä¹°å…¥çš„æœŸæƒï¼Œéœ€è¦å–å‡ºå¹³ä»“</p>
                
                <div class="futu-settings">
                    <div class="futu-setting profit">
                        <div class="futu-header">
                            <span class="futu-icon">âœ…</span>
                            <span class="futu-label">æ­¢ç›ˆå•</span>
                            <span class="futu-badge muted-badge">é…åˆShortå¹³ä»“</span>
                        </div>
                        <div class="futu-body">
                            <div class="futu-row">
                                <span class="futu-key">æ¡ä»¶ç±»å‹</span>
                                <span class="futu-val">ä»·æ ¼ â‰¤ è§¦å‘ä»·</span>
                            </div>
                            <div class="futu-row highlight">
                                <span class="futu-key">è§¦å‘ä»·æ ¼</span>
                                <span class="futu-val futu-price" id="longTpPrice">$0.01</span>
                            </div>
                            <div class="futu-row">
                                <span class="futu-key">è®¢å•ç±»å‹</span>
                                <span class="futu-val">å¸‚ä»·å–å‡º</span>
                            </div>
                        </div>
                    </div>

                    <div class="futu-setting loss">
                        <div class="futu-header">
                            <span class="futu-icon">ğŸ›‘</span>
                            <span class="futu-label">æ­¢æŸå•</span>
                            <span class="futu-badge muted-badge">é…åˆShortå¹³ä»“</span>
                        </div>
                        <div class="futu-body">
                            <div class="futu-row">
                                <span class="futu-key">æ¡ä»¶ç±»å‹</span>
                                <span class="futu-val">ä»·æ ¼ â‰¥ è§¦å‘ä»·</span>
                            </div>
                            <div class="futu-row highlight">
                                <span class="futu-key">è§¦å‘ä»·æ ¼</span>
                                <span class="futu-val futu-price" id="longSlPrice">$0.00</span>
                            </div>
                            <div class="futu-row">
                                <span class="futu-key">è®¢å•ç±»å‹</span>
                                <span class="futu-val">å¸‚ä»·å–å‡º</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="card delta-section" style="border: 1px solid rgba(255, 146, 43, 0.3); background: linear-gradient(145deg, #2a1f14, #1a1510);">
                <h2 class="card-title" style="color: #ff922b;">ğŸ¯ Delta / èƒœç‡æ¨è</h2>
                <p class="section-desc">æ ¹æ®æ­¢ç›ˆæ­¢æŸæ¯”ä¾‹ï¼Œè®¡ç®—æ‰€éœ€èƒœç‡å¹¶æ¨è Delta èŒƒå›´</p>
                
                <div class="delta-grid" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 10px;">
                    <div class="delta-item" style="background: rgba(0,0,0,0.2); padding: 8px; border-radius: 6px; text-align: center;">
                        <span style="display: block; font-size: 0.65rem; color: #6a6a80; margin-bottom: 2px;">ç›ˆäºæ¯”</span>
                        <span id="riskRewardRatio" style="display: block; font-size: 1.1rem; font-weight: 700; color: #ff922b;">1:2.67</span>
                    </div>
                    <div class="delta-item" style="background: rgba(0,0,0,0.2); padding: 8px; border-radius: 6px; text-align: center;">
                        <span style="display: block; font-size: 0.65rem; color: #6a6a80; margin-bottom: 2px;">æ‰€éœ€èƒœç‡</span>
                        <span id="requiredWinRate" style="display: block; font-size: 1.1rem; font-weight: 700; color: #ff922b;">72.7%</span>
                    </div>
                    <div class="delta-item" style="background: rgba(0,0,0,0.2); padding: 8px; border-radius: 6px; text-align: center;">
                        <span style="display: block; font-size: 0.65rem; color: #6a6a80; margin-bottom: 2px;">æœŸæœ›å€¼</span>
                        <span id="expectedValue" style="display: block; font-size: 1.1rem; font-weight: 700; color: #00d68f;">+0.0%</span>
                    </div>
                </div>

                <div class="delta-recommendation" style="background: rgba(255, 146, 43, 0.1); padding: 10px; border-radius: 8px; border: 1px solid rgba(255, 146, 43, 0.2); margin-bottom: 8px;">
                    <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 6px;">
                        <span style="font-size: 1rem;">ğŸ“Š</span>
                        <span style="font-weight: 600; font-size: 0.85rem; color: #fff;">Short Leg Delta å»ºè®®</span>
                    </div>
                    <div id="deltaRecommendation" style="font-size: 1.2rem; font-weight: 700; color: #00d68f; margin-bottom: 4px;">
                        â‰¤ 0.15
                    </div>
                    <div id="deltaExplanation" style="font-size: 0.7rem; color: #a0a0b8; line-height: 1.5;">
                        å»ºè®®é€‰æ‹© Delta â‰¤ 0.15 çš„æœŸæƒï¼ˆç†è®ºèƒœç‡ ~85%ï¼‰ï¼Œç»™äºˆçº¦ 12% çš„å®‰å…¨è¾¹é™…
                    </div>
                </div>

                <!-- ğŸ† æœ€ä½³ç­–ç•¥æ¨è -->
                <div style="padding: 10px; background: linear-gradient(145deg, rgba(0,214,143,0.15), rgba(0,214,143,0.05)); border-radius: 8px; border: 1px solid rgba(0,214,143,0.3); margin-bottom: 8px;">
                    <div style="font-size: 0.7rem; color: #00d68f; margin-bottom: 8px; font-weight: 600;">ğŸ† æœ€ä½³ç­–ç•¥æ¨è (Delta 0.10, èƒœç‡ 90%)</div>
                    <div id="topStrategies" style="display: flex; flex-direction: column; gap: 6px;">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div style="font-size: 0.55rem; color: #6a6a80; margin-top: 8px; line-height: 1.3;">
                        ğŸ“Š åŸºäº Delta 0.10 (90%èƒœç‡) è®¡ç®—çš„æœŸæœ›å€¼æ’å
                    </div>
                </div>

                <!-- Delta ä¸èƒœç‡å¯¹ç…§è¡¨ -->
                <div style="padding: 8px; background: rgba(0,0,0,0.2); border-radius: 6px;">
                    <div style="font-size: 0.65rem; color: #6a6a80; margin-bottom: 6px;">ğŸ² Delta ä¸ç†è®ºèƒœç‡</div>
                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 3px; text-align: center; font-size: 0.6rem;">
                        <div style="padding: 3px; background: rgba(255,255,255,0.05); border-radius: 3px;">
                            <div style="color: #ff922b; font-weight: 600;">0.30</div>
                            <div style="color: #6a6a80;">~70%</div>
                        </div>
                        <div style="padding: 3px; background: rgba(255,255,255,0.05); border-radius: 3px;">
                            <div style="color: #ff922b; font-weight: 600;">0.20</div>
                            <div style="color: #6a6a80;">~80%</div>
                        </div>
                        <div style="padding: 3px; background: rgba(255,255,255,0.05); border-radius: 3px;">
                            <div style="color: #ff922b; font-weight: 600;">0.15</div>
                            <div style="color: #6a6a80;">~85%</div>
                        </div>
                        <div style="padding: 3px; background: rgba(255,255,255,0.05); border-radius: 3px;">
                            <div style="color: #ff922b; font-weight: 600;">0.10</div>
                            <div style="color: #6a6a80;">~90%</div>
                        </div>
                        <div style="padding: 3px; background: rgba(255,255,255,0.05); border-radius: 3px;">
                            <div style="color: #ff922b; font-weight: 600;">0.05</div>
                            <div style="color: #6a6a80;">~95%</div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="card summary-section">
                <h2 class="card-title">ğŸ“‹ ç­–ç•¥æ¦‚è§ˆ</h2>
                <div class="summary-grid">
                    <div class="summary-item">
                        <span class="summary-label">ç­–ç•¥æ”¶å…¥</span>
                        <span class="summary-value" id="summaryCredit">$0.00</span>
                    </div>
                    <div class="summary-item profit">
                        <span class="summary-label">æ­¢ç›ˆç›®æ ‡</span>
                        <span class="summary-value" id="summaryProfit">+$0.00 (75%)</span>
                    </div>
                    <div class="summary-item loss">
                        <span class="summary-label">æ­¢æŸé™é¢</span>
                        <span class="summary-value" id="summaryLoss">-$0.00 (200%)</span>
                    </div>
                </div>
            </section>

            <section class="card tips-section">
                <h2 class="card-title">ğŸ’¡ å¯Œé€”è®¾ç½®æç¤º</h2>
                <div class="tips-content">
                    <p>1. <strong>ä¼˜å…ˆè®¾ç½® Short Leg</strong>ï¼Œè¿™æ˜¯ä¸»è¦é£é™©æ¥æº</p>
                    <p>2. Long Leg å¯é€‰è®¾ç½®ï¼Œä¸»è¦ç”¨äºåŒæ­¥å¹³ä»“</p>
                    <p>3. æ¡ä»¶å•é€‰æ‹© <strong>"åˆ°ä»·è§¦å‘"</strong> ç±»å‹</p>
                    <p>4. æ”¶ç›˜å‰ 15 åˆ†é’Ÿå»ºè®®æ‰‹åŠ¨å¹³ä»“</p>
                </div>
            </section>
        </main>

        <footer class="footer">
            <p>0DTE Credit Spread Calculator</p>
        </footer>
    </div>

    <script>
// è·å–DOMå…ƒç´ 
var sellPriceInput = document.getElementById('sellPrice');
var buyPriceInput = document.getElementById('buyPrice');
var takeProfitPercentInput = document.getElementById('takeProfitPercent');
var stopLossPercentInput = document.getElementById('stopLossPercent');

var netCreditEl = document.getElementById('netCredit');
var shortTpPriceEl = document.getElementById('shortTpPrice');
var shortSlPriceEl = document.getElementById('shortSlPrice');
var shortProfitBadgeEl = document.getElementById('shortProfitBadge');
var shortLossBadgeEl = document.getElementById('shortLossBadge');
var longTpPriceEl = document.getElementById('longTpPrice');
var longSlPriceEl = document.getElementById('longSlPrice');
var summaryCreditEl = document.getElementById('summaryCredit');
var summaryProfitEl = document.getElementById('summaryProfit');
var summaryLossEl = document.getElementById('summaryLoss');

// Deltaæ¨èç›¸å…³å…ƒç´ 
var riskRewardRatioEl = document.getElementById('riskRewardRatio');
var requiredWinRateEl = document.getElementById('requiredWinRate');
var deltaRecommendationEl = document.getElementById('deltaRecommendation');
var deltaExplanationEl = document.getElementById('deltaExplanation');
var expectedValueEl = document.getElementById('expectedValue');
var topStrategiesEl = document.getElementById('topStrategies');

// æ ¼å¼åŒ–ä»·æ ¼
function formatPrice(value) {
    if (isNaN(value) || value === null || value < 0) return '$0.00';
    return '$' + value.toFixed(2);
}

// è®¡ç®—æœŸæœ›å€¼
function calculateExpectedValue(winRate, profitPercent, lossPercent) {
    // æœŸæœ›å€¼ = èƒœç‡ Ã— ç›ˆåˆ©% - è´¥ç‡ Ã— äºæŸ%
    var ev = (winRate / 100) * profitPercent - ((100 - winRate) / 100) * lossPercent;
    return ev;
}

// Deltaæ¨èå‡½æ•°
function getDeltaRecommendation(requiredWinRate) {
    // Deltaä¸èƒœç‡çš„å¯¹åº”å…³ç³»
    var deltaTable = [
        { delta: 0.05, winRate: 95, label: 'â‰¤ 0.05', desc: 'æä¿å®ˆå‹ï¼Œæƒåˆ©é‡‘è¾ƒä½ä½†èƒœç‡æé«˜' },
        { delta: 0.10, winRate: 90, label: 'â‰¤ 0.10', desc: 'ä¿å®ˆå‹ï¼Œæƒåˆ©é‡‘é€‚ä¸­ï¼Œèƒœç‡é«˜' },
        { delta: 0.15, winRate: 85, label: 'â‰¤ 0.15', desc: 'å¹³è¡¡å‹ï¼Œæƒåˆ©é‡‘å’Œèƒœç‡å‡è¡¡' },
        { delta: 0.20, winRate: 80, label: 'â‰¤ 0.20', desc: 'é€‚ä¸­å‹ï¼Œæƒåˆ©é‡‘è¾ƒé«˜' },
        { delta: 0.25, winRate: 75, label: 'â‰¤ 0.25', desc: 'æ¿€è¿›å‹ï¼Œæƒåˆ©é‡‘é«˜ä½†é£é™©å¢åŠ ' },
        { delta: 0.30, winRate: 70, label: 'â‰¤ 0.30', desc: 'é«˜é£é™©å‹ï¼Œä¸å»ºè®®æ–°æ‰‹ä½¿ç”¨' }
    ];
    
    // æ‰¾åˆ°åˆšå¥½æ»¡è¶³æ‰€éœ€èƒœç‡çš„Deltaï¼ˆéœ€è¦10-15%å®‰å…¨è¾¹é™…ï¼‰
    var safetyMargin = 10; // å®‰å…¨è¾¹é™…ç™¾åˆ†æ¯”
    var targetWinRate = requiredWinRate + safetyMargin;
    
    for (var i = 0; i < deltaTable.length; i++) {
        if (deltaTable[i].winRate >= targetWinRate) {
            return {
                delta: deltaTable[i].delta,
                label: deltaTable[i].label,
                winRate: deltaTable[i].winRate,
                margin: deltaTable[i].winRate - requiredWinRate,
                desc: deltaTable[i].desc
            };
        }
    }
    
    // å¦‚æœæ‰€éœ€èƒœç‡å¤ªé«˜ï¼Œè¿”å›æœ€ä¿å®ˆçš„
    return {
        delta: 0.05,
        label: 'â‰¤ 0.05',
        winRate: 95,
        margin: 95 - requiredWinRate,
        desc: 'éœ€è¦æé«˜èƒœç‡ï¼Œå»ºè®®é‡æ–°è°ƒæ•´æ­¢ç›ˆæ­¢æŸæ¯”ä¾‹'
    };
}

// ç”Ÿæˆå¯¹ç…§è¡¨
function generateTopStrategies(currentTP, currentSL) {
    var presets = [
        { tp: 50, sl: 50 },
        { tp: 50, sl: 100 },
        { tp: 50, sl: 150 },
        { tp: 75, sl: 100 },
        { tp: 75, sl: 150 },
        { tp: 75, sl: 200 },
        { tp: 100, sl: 100 },
        { tp: 100, sl: 200 }
    ];
    
    // è®¡ç®—æ‰€æœ‰ç­–ç•¥çš„æœŸæœ›å€¼å¹¶æ’åº
    var strategies = [];
    for (var i = 0; i < presets.length; i++) {
        var tp = presets[i].tp;
        var sl = presets[i].sl;
        var ev = calculateExpectedValue(90, tp, sl); // ä½¿ç”¨ Delta 0.10 (90% èƒœç‡)
        var ratio = sl / tp;
        strategies.push({
            tp: tp,
            sl: sl,
            ev: ev,
            ratio: ratio
        });
    }
    
    // æŒ‰æœŸæœ›å€¼ä»é«˜åˆ°ä½æ’åº
    strategies.sort(function(a, b) { return b.ev - a.ev; });
    
    // ç”Ÿæˆå‰3ä¸ªæœ€ä½³ç­–ç•¥çš„ HTML
    var html = '';
    var medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
    for (var i = 0; i < 3 && i < strategies.length; i++) {
        var s = strategies[i];
        var isCurrent = (s.tp === currentTP && s.sl === currentSL);
        var bgColor = isCurrent ? 'rgba(255,146,43,0.3)' : 'rgba(0,0,0,0.2)';
        var borderColor = isCurrent ? '#ff922b' : 'rgba(255,255,255,0.1)';
        
        html += '<div style="display: flex; align-items: center; justify-content: space-between; padding: 8px 10px; background: ' + bgColor + '; border-radius: 6px; border: 1px solid ' + borderColor + ';">';
        html += '<div style="display: flex; align-items: center; gap: 8px;">';
        html += '<span style="font-size: 1rem;">' + medals[i] + '</span>';
        html += '<div>';
        html += '<div style="font-size: 0.8rem; font-weight: 600; color: #fff;">æ­¢ç›ˆ ' + s.tp + '% / æ­¢æŸ ' + s.sl + '%</div>';
        html += '<div style="font-size: 0.6rem; color: #6a6a80;">ç›ˆäºæ¯” 1:' + s.ratio.toFixed(2) + '</div>';
        html += '</div>';
        html += '</div>';
        html += '<div style="text-align: right;">';
        html += '<div style="font-size: 1rem; font-weight: 700; color: #00d68f;">+' + s.ev.toFixed(0) + '%</div>';
        html += '<div style="font-size: 0.55rem; color: #6a6a80;">æœŸæœ›å€¼</div>';
        html += '</div>';
        html += '</div>';
    }
    
    return html;
}

// è®¡ç®—å‡½æ•°
function calculate() {
    var sellPrice = parseFloat(sellPriceInput.value) || 0;
    var buyPrice = parseFloat(buyPriceInput.value) || 0;
    var takeProfitPercent = parseFloat(takeProfitPercentInput.value) || 75;
    var stopLossPercent = parseFloat(stopLossPercentInput.value) || 200;

    var netCredit = sellPrice - buyPrice;
    netCreditEl.textContent = formatPrice(netCredit);
    netCreditEl.style.color = netCredit >= 0 ? '#5c7cfa' : '#ff4d6a';

    var profitAmount = netCredit * (takeProfitPercent / 100);
    var lossAmount = netCredit * (stopLossPercent / 100);

    var takeProfitSpread = netCredit * (1 - takeProfitPercent / 100);
    var stopLossSpread = netCredit * (1 + stopLossPercent / 100);

    var shortTpPrice = Math.max(0, takeProfitSpread);
    var shortSlPrice = stopLossSpread;

    shortTpPriceEl.textContent = formatPrice(shortTpPrice);
    shortSlPriceEl.textContent = formatPrice(shortSlPrice);
    shortProfitBadgeEl.textContent = 'ç›ˆåˆ© ' + formatPrice(profitAmount);
    shortLossBadgeEl.textContent = 'äºæŸ ' + formatPrice(lossAmount);

    var longTpPrice = 0.01;
    var longSlPrice = buyPrice > 0 ? Math.max(0.01, buyPrice * 0.5) : 0.01;

    longTpPriceEl.textContent = formatPrice(longTpPrice);
    longSlPriceEl.textContent = formatPrice(longSlPrice);

    summaryCreditEl.textContent = formatPrice(netCredit);
    summaryProfitEl.textContent = '+' + formatPrice(profitAmount) + ' (' + takeProfitPercent + '%)';
    summaryLossEl.textContent = '-' + formatPrice(lossAmount) + ' (' + stopLossPercent + '%)';

    // è®¡ç®—ç›ˆäºæ¯”å’Œæ‰€éœ€èƒœç‡
    var riskRewardRatio = stopLossPercent / takeProfitPercent;
    var requiredWinRate = (stopLossPercent / (takeProfitPercent + stopLossPercent)) * 100;
    
    // æ›´æ–°ç›ˆäºæ¯”æ˜¾ç¤º
    riskRewardRatioEl.textContent = '1:' + riskRewardRatio.toFixed(2);
    requiredWinRateEl.textContent = requiredWinRate.toFixed(1) + '%';
    
    // æ ¹æ®æ‰€éœ€èƒœç‡è®¾ç½®é¢œè‰²
    if (requiredWinRate > 80) {
        requiredWinRateEl.style.color = '#ff4d6a'; // çº¢è‰² - é«˜é£é™©
    } else if (requiredWinRate > 70) {
        requiredWinRateEl.style.color = '#ff922b'; // æ©™è‰² - ä¸­ç­‰
    } else {
        requiredWinRateEl.style.color = '#00d68f'; // ç»¿è‰² - å®‰å…¨
    }
    
    // è·å–Deltaæ¨è
    var recommendation = getDeltaRecommendation(requiredWinRate);
    deltaRecommendationEl.textContent = recommendation.label;
    deltaExplanationEl.textContent = 'å»ºè®® Delta ' + recommendation.label + 'ï¼ˆç†è®ºèƒœç‡ ~' + recommendation.winRate + '%ï¼‰ï¼Œå®‰å…¨è¾¹é™… ' + recommendation.margin.toFixed(0) + '%ã€‚' + recommendation.desc;
    
    // æ ¹æ®å®‰å…¨è¾¹é™…è®¾ç½®é¢œè‰²
    if (recommendation.margin >= 15) {
        deltaRecommendationEl.style.color = '#00d68f'; // ç»¿è‰² - å……è¶³
    } else if (recommendation.margin >= 10) {
        deltaRecommendationEl.style.color = '#ff922b'; // æ©™è‰² - é€‚ä¸­
    } else {
        deltaRecommendationEl.style.color = '#ff4d6a'; // çº¢è‰² - ä¸è¶³
    }
    
    // è®¡ç®—å½“å‰é…ç½®çš„æœŸæœ›å€¼ï¼ˆä½¿ç”¨æ¨èçš„ Delta èƒœç‡ï¼‰
    var currentEV = calculateExpectedValue(recommendation.winRate, takeProfitPercent, stopLossPercent);
    var evSign = currentEV >= 0 ? '+' : '';
    expectedValueEl.textContent = evSign + currentEV.toFixed(1) + '%';
    expectedValueEl.style.color = currentEV >= 0 ? '#00d68f' : '#ff4d6a';
    
    // ç”Ÿæˆæœ€ä½³ç­–ç•¥æ¨è
    topStrategiesEl.innerHTML = generateTopStrategies(takeProfitPercent, stopLossPercent);
}

// ä¸ºæ¯ä¸ªè¾“å…¥æ¡†ç»‘å®šå¤šç§äº‹ä»¶ä»¥ç¡®ä¿iOSå…¼å®¹æ€§
var inputs = [sellPriceInput, buyPriceInput, takeProfitPercentInput, stopLossPercentInput];
var events = ['input', 'change', 'keyup', 'blur', 'touchend'];

for (var i = 0; i < inputs.length; i++) {
    for (var j = 0; j < events.length; j++) {
        inputs[i].addEventListener(events[j], calculate);
    }
}

// æ¯500msè‡ªåŠ¨æ›´æ–°ä¸€æ¬¡ï¼Œç¡®ä¿ä¸ä¼šé—æ¼
setInterval(calculate, 500);

// åˆå§‹è®¡ç®—
calculate();
    </script>
</body>
</html>
